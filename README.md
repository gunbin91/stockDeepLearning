# AI 주식 추천 시스템

## 1. 프로젝트 개요

이 프로젝트는 다양한 데이터를 기반으로 주식 종목을 분석하고 추천하는 시스템입니다. 재무 데이터, 시장 수급, 주가 모멘텀, 머신러닝 예측, 뉴스 감성 분석 등 여러 요소를 종합하여 종목별 점수를 산출하고 순위를 매겨 투자 의사결정을 돕습니다.

## 2. 핵심 추천 로직 (평가 기준)

이 시스템은 다음 6가지 핵심 요소를 종합하여 종목의 최종 점수를 산출하고 순위를 매깁니다. 각 요소는 0~100점 척도로 정규화되며, 가중 평균을 통해 최종 점수에 반영됩니다.

1.  **가치 점수 (Value Score)**: 기업의 내재 가치 대비 현재 주가 수준을 평가합니다. (저평가)
2.  **퀄리티 점수 (Quality Score)**: 기업의 재무 건전성과 수익성을 평가합니다. (우량주)
3.  **모멘텀 점수 (Momentum Score)**: 최근 주가 상승 추세의 강도를 평가합니다. (추세)
4.  **수급 점수 (Supply/Demand Score)**: 기관 및 외국인 투자자의 순매수 동향을 평가합니다. (수급)
5.  **머신러닝 예측 (ML Prediction)**: RandomForest 모델이 과거 데이터를 학습하여 미래 주가 상승 확률을 예측합니다.
6.  **뉴스 감성 점수 (Sentiment Score)**: 최신 뉴스 헤드라인을 분석하여 해당 종목에 대한 시장의 긍정/부정 감성을 평가합니다.

## 2.1. 최종 점수 산정 방식 (가중치)

최종 점수는 아래 6가지 팩터 점수의 **가중 평균**으로 계산됩니다. 각 팩터의 중요도를 나타내는 가중치는 다음과 같습니다.

| 팩터 (Factor) | 가중치 (Weight) | 설명 |
| :--- | :---: | :--- |
| **모멘텀 (Momentum)** | 25% | 최근 주가 상승 추세의 강도 |
| **ML 예측 (ML Prediction)** | 20% | AI 모델이 예측한 미래 상승 확률 |
| **가치 (Value)** | 15% | 기업 내재가치 대비 저평가 정도 |
| **퀄리티 (Quality)** | 15% | 기업의 재무 건전성 및 수익성 |
| **수급 (Supply/Demand)** | 15% | 기관/외국인의 순매수 동향 |
| **변동성 (Volatility)** | 10% | 주가 변동성이 낮을수록 높은 점수 |

- **계산 과정**:
  1. 각 종목에 대해 위 6가지 팩터 점수(0~100점)를 계산합니다.
  2. 각 팩터 점수에 해당하는 가중치를 곱하여 합산합니다.
  3. 이렇게 계산된 가중 평균 점수를 전체 분석 대상 종목 내에서 다시 0~100점 척도로 스케일링하여 `최종 점수`를 산출합니다.
  4. 최종 점수가 높을수록 시스템이 더 강력하게 추천하는 종목을 의미합니다.

(*참고: 뉴스 감성분석 및 딥러닝 트렌드 점수는 현재 최종 점수 계산에서 제외되어 있습니다.*)

---

## 3. 사용 방법

### 3.1. 설치 및 실행

1.  **저장소 복제 (Clone)**
    ```bash
    git clone [저장소_URL]
    cd stockDeepLearning
    ```

2.  **앱 실행 (스크립트 사용)**
    프로젝트 루트 디렉토리에서 아래 명령어를 실행하세요.
    ```bash
    ./start_app.command
    ```
    -   이 스크립트는 필요한 모든 작업을 **자동으로** 처리합니다:
        -   Python 가상 환경(`venv`) 생성
        -   필수 라이브러리 설치
        -   Streamlit 웹 애플리케이션 실행
    -   최초 실행 시, 라이브러리 설치로 인해 시간이 다소 소요될 수 있습니다.

### 3.2. macOS 사용자 문제 해결

macOS 환경에서 `start_app.command` 실행 시 오류가 발생하면 아래 해결 방법을 시도해 보세요.

-   **오류 1: "악성 소프트웨어인지 확인할 수 없기 때문에 열 수 없습니다."**
    -   **원인**: macOS의 Gatekeeper 보안 기능이 다운로드된 스크립트의 실행을 차단하는 경우입니다.
    -   **해결**: 터미널에서 아래 명령어를 입력하여 스크립트의 격리 속성을 제거합니다.
        ```bash
        xattr -d com.apple.quarantine start_app.command
        ```

-   **오류 2: "incompatible architecture (have 'x86_64', need 'arm64')"**
    -   **원인**: Apple Silicon (M1/M2/M3) Mac에서 Intel (x86_64) 버전의 라이브러리가 설치되어 발생하는 아키텍처 충돌입니다.
    -   **해결**: 아래 명령어를 실행하여 가상 환경을 삭제하고, `arm64` 아키텍처로 모든 라이브러리를 다시 설치합니다.
        ```bash
        rm -rf venv
        arch -arm64 python3 -m venv venv
        arch -arm64 venv/bin/pip install --timeout=600 -r requirements.txt
        arch -arm64 venv/bin/pip install --timeout=600 'transformers[torch]' sentencepiece
        ```
        위 명령어 실행 후, 다시 `./start_app.command`로 앱을 실행하세요.

---

## 4. 모델 재학습 및 최적화

**주기적인 재학습과 최적화는 모델의 예측 성능을 유지하는 데 매우 중요합니다.**

### 4.1. 왜 재학습이 필요한가?

주식 시장은 계속 변하기 때문에, 과거 데이터로 학습된 모델은 시간이 지날수록 예측 정확도가 떨어집니다. 최신 시장 상황을 모델에 반영하기 위해 주기적으로 재학습을 수행해야 합니다. **최소 한 달에 한 번** 재학습하는 것을 권장합니다.

### 4.2. 모델 최적화: 더 빠르고 효율적인 하이퍼파라미터 탐색

모델의 성능을 결정하는 중요한 요소 중 하나는 **하이퍼파라미터**입니다. 이 프로젝트에서는 모델이 최상의 성능을 낼 수 있는 최적의 하이퍼파라미터 조합을 찾기 위해 `RandomizedSearchCV`를 사용합니다.

-   **기존 방식 (`GridSearchCV`)**: 모든 가능한 하이퍼파라미터 조합을 하나하나 테스트하는 방식으로, 최적의 조합을 보장하지만 시간이 매우 오래 걸리는 단점이 있었습니다.
-   **개선된 방식 (`RandomizedSearchCV`)**: 지정된 횟수만큼 파라미터 조합을 **무작위로 샘플링**하여 테스트합니다. 이 방식은 훨씬 짧은 시간 안에 `GridSearchCV`와 비슷하거나 더 좋은 성능의 조합을 효율적으로 찾을 수 있는 장점이 있습니다. 이를 통해 더 넓은 범위의 하이퍼파라미터를 빠르게 탐색하여 모델 성능을 개선합니다.

### 4.3. 재학습 및 최적화 실행 방법

프로젝트 루트 디렉토리에서 아래 명령어를 실행하세요.

```bash
python train_model.py
```

-   이 스크립트는 최근 3년간의 주가 데이터를 다시 수집하여 `RandomizedSearchCV`로 RandomForest 모델을 최적화 및 학습시킨 후, 그 결과를 `stock_prediction_model_rf_upgraded.joblib` 파일에 덮어씁니다.
-   `app.py`는 이 저장된 모델 파일을 불러와 예측을 수행합니다.

### 4.4. 모델 학습 데이터 및 피처

AI 모델은 **과거 3년간의 주식 데이터**를 기반으로 학습됩니다. 각 종목에 대해 다음과 같은 다양한 유형의 데이터를 수집하고 가공하여 모델의 입력(피처)으로 사용합니다.

**1. 데이터 수집:**
- **가격 데이터 (OHLCV):** 시가, 고가, 저가, 종가, 거래량.
- **기본적 분석 데이터:** BPS (주당순자산), PER (주가수익비율), PBR (주가순자산비율), EPS (주당순이익), DIV (배당수익률).

**2. 타겟 변수 (모델이 예측하는 값):**
- **20 거래일 후 5% 이상 상승 여부:** 모델은 특정 종목이 20 거래일 후에 현재 종가 대비 5% 이상 상승할지 여부(이진 분류: 상승 시 1, 아니면 0)를 예측하도록 학습됩니다.

**3. 피처 엔지니어링 (모델 입력으로 사용되는 가공된 데이터):**
- **수익률 및 변동성:** 1개월 수익률, 3개월 수익률, 1개월 변동성.
- **거래량 관련:** 거래량 변화율, 5일 이동평균 거래량, 20일 이동평균 거래량.
- **기술적 지표:**
  - RSI (상대강도지수, 14일).
  - MACD (이동평균 수렴/확산, 12/26/9).
  - SMA (단순 이동평균, 5일, 20일, 60일).
- **ROE (자기자본이익률):** PBR과 PER을 활용하여 계산.

이러한 데이터를 종합적으로 학습하여 모델은 미래 주가 움직임을 예측하는 패턴을 파악합니다.

---

## 5. 주요 파일 설명

-   `app.py`: Streamlit 웹 애플리케이션의 메인 실행 파일입니다.
-   `start_app.command`: 가상 환경 설정 및 앱 실행을 자동화하는 스크립트입니다.
-   `train_model.py`: 머신러닝 모델(RandomForest)을 학습시키고 결과를 저장하는 스크립트입니다.
-   `stock_prediction_model_rf.joblib`: `train_model.py`를 통해 학습된 모델과 피처 정보가 저장된 파일입니다.
-   `requirements.txt`: 프로젝트에 필요한 Python 라이브러리 목록입니다.
-   `data_fetcher.py`: 주가, 재무 정보 등 데이터를 수집하는 모듈입니다.
-   `scoring.py`, `ml_model.py`, `nlp.py`, `ensemble.py`: 각 팩터 점수 계산, 예측, 최종 점수 산출 로직을 담고 있는 모듈입니다.

---

## 6. 면책 조항

이 프로젝트는 학습 및 연구 목적으로 개발되었습니다. 제공되는 모든 정보와 추천은 투자 자문이 아니며, 실제 투자 결정에 사용되어서는 안 됩니다. 투자 결정은 항상 본인의 판단과 책임 하에 이루어져야 합니다. 본 시스템의 사용으로 발생하는 어떠한 손실에 대해서도 개발자는 책임을 지지 않습니다.