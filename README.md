# AI 기반 주식 종목 분석 및 추천 시스템

## 1. 프로젝트 개요

본 프로젝트는 KOSPI 및 KOSDAQ 상장 종목을 대상으로 기술적 지표와 재무 데이터를 종합 분석하여 투자 매력도가 높은 종목을 발굴하는 것을 목표로 합니다.

다양한 팩터(가치, 퀄리티, 모멘텀 등)를 기반으로 종목의 점수를 산출하고, 랜덤 포레스트(Random Forest) 머신러닝 모델을 통해 '1개월 후 5% 이상 상승할 확률'을 예측하여 사용자에게 종합적인 투자 정보를 제공합니다.

모든 과정은 Streamlit 기반의 웹 애플리케이션을 통해 시각적으로 제공되어 사용자가 쉽게 정보를 탐색할 수 있습니다.

## 2. 주요 기능

- **📈 데이터 수집**: `FinanceDataReader`와 DART Open API를 통해 주가, 재무제표 등 최신 데이터를 안정적으로 수집
- **✨ 퀀트 팩터 분석**: 가치, 퀄리티, 모멘텀 등 검증된 퀀트 팩터를 기반으로 종목별 점수 산출
- **🤖 머신러닝 예측**: 과거 3년치 데이터를 학습한 랜덤 포레스트 모델을 통해 '20일 후 5% 이상 상승 확률' 예측
- **📊 대화형 대시보드**: `Streamlit`을 활용하여 전체 분석 결과를 사용자가 직접 필터링하고 정렬하며 탐색 가능
- **⚙️ 설정 가능한 모델 학습**: 스크립트 실행 시 CPU 코어 수, `max_depth` 등 주요 파라미터를 직접 설정하여 모델 재학습 가능

## 3. 기술 스택 및 주요 라이브러리

- **언어**: Python
- **데이터 분석**: Pandas, Numpy, Scipy
- **데이터 수집**: FinanceDataReader, Requests
- **머신러닝**: Scikit-learn (RandomForest, RandomizedSearchCV)
- **웹 애플리케이션**: Streamlit
- **기타**: Joblib, Tqdm, Pandas-TA

*(전체 라이브러리는 `requirements.txt` 파일 참조)*

## 4. 설치 및 실행 방법

### 4.1. 사전 준비

1.  **DART API 키 발급**
    - **[DART 인증키 신청 페이지](https://opendart.fss.or.kr/uss/umt/EgovStplat.do)**에 접속하여 **무료 인증키를 발급**받습니다.
    - 발급받은 키(약 40자)를 복사하여 아래 2개 파일의 최상단에 있는 `DART_API_KEY` 변수에 붙여넣습니다.
      - `data_fetcher.py`
      - `train_model.py`

2.  **종목-고유번호 매핑 파일 생성 (최초 1회 필수)**
    - DART API는 종목코드가 아닌 고유번호를 사용하므로, 이를 변환해주는 매핑 파일이 필요합니다.
    - 터미널에서 아래 명령어를 실행하여 `corp_code_map.csv` 파일을 생성합니다.
      ```bash
      python make_corp_map.py
      ```

3.  **필요 라이브러리 설치**
    - 프로젝트 가상 환경을 활성화한 후, 터미널에서 아래 명령어를 실행합니다.
      ```bash
      pip install -r requirements.txt
      ```

### 4.2. 모델 학습 (선택 사항, 권장)

최신 데이터로 모델을 직접 학습시키려면, 대화형 스크립트를 실행합니다.

-   **macOS / Linux**:
    ```bash
    ./train_model.command
    ```
-   **Windows**:
    ```bash
    ./train_model.bat
    ```
-   스크립트를 실행하면 CPU 코어 수, 테스트 반복 횟수(`n_iter`), `max_depth` 등을 순서대로 질문합니다. 입력 후 엔터를 누르면 학습이 시작되며, 완료 시 `stock_prediction_model_rf_upgraded.joblib` 파일이 생성/업데이트됩니다.

### 4.3. 웹 애플리케이션 실행

-   **macOS / Linux**:
    ```bash
    ./start_app.command
    ```
-   **Windows**:
    ```bash
    ./start_app.bat
    ```
-   또는 터미널에서 직접 `streamlit run app.py`를 실행할 수도 있습니다.

## 5. 시스템 로직 상세 설명

### 5.1. 데이터 수집 및 가공

-   **분석 대상**: KOSPI, KOSDAQ 전체 상장 종목 (스팩, 리츠 제외)
-   **데이터 기간**: 모델 학습 시 **최근 3년치**의 일별 주가 데이터를 사용합니다.
-   **데이터 출처**:
    - **종목 목록/상장주식수**: `FinanceDataReader` (`fdr.StockListing('KRX-MARCAP')`)
    - **일별 주가**: `FinanceDataReader` (`fdr.DataReader`)
    - **재무 정보 (당기순이익, 자본총계)**: DART API 직접 호출 (`requests`)

### 5.2. 주요 피처 (Features)

머신러닝 모델 학습과 팩터 점수 계산에 사용되는 주요 기술적/재무적 지표는 다음과 같습니다.

-   **모멘텀 지표**: `수익률(1M)`, `수익률(3M)`
-   **가치 지표**: `PER` (주가수익비율), `PBR` (주가순자산비율)
-   **퀄리티 지표**: `ROE` (자기자본이익률)
-   **기술적 보조지표**: `RSI_14`, `MACD` 관련 지표 3종
-   **변동성 지표**: `변동성(1M)` (1개월 주가 표준편차)

### 5.3. 팩터 스코어링 로직 (`scoring.py`)

-   **가치 점수**: `PER`과 `PBR`의 역수 순위. (낮을수록 좋음)
-   **퀄리티 점수**: `ROE`의 순위. (높을수록 좋음)
-   **모멘텀 점수**: 1개월, 3개월 수익률의 순위. (높을수록 좋음)
-   **변동성 점수**: 1개월 변동성의 역수 순위. (낮을수록 좋음)
-   **수급 점수**: 현재는 사용되지 않으며 0점으로 고정.

### 5.4. 머신러닝 모델 (`train_model.py`)

-   **모델 종류**: `RandomForestClassifier` (랜덤 포레스트 분류 모델)
-   **예측 목표 (Target)**: "**20 거래일(약 1개월) 후에 주가가 5% 이상 상승할 것인가?**" (True/False)
-   **최적화**: `RandomizedSearchCV`를 사용하여 최적의 하이퍼파라미터를 탐색하고, 이를 통해 모델 성능을 극대화합니다.

## 6. 면책 조항

본 프로젝트는 학습 및 연구 목적으로 개발되었습니다. 제공되는 모든 정보와 추천은 투자 자문이 아니며, 실제 투자 결정에 따른 책임은 전적으로 투자자 본인에게 있습니다.